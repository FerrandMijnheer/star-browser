<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css" />
    <title id="appTitle">Star Browser</title>
  </head>

  <body>
    <div class="info-bar">
      <input
        type="image"
        src="images/logos/logo.svg"
        alt="logo"
        class="info-bar-img info-bar-item"
        id="logoButton"
      />
      <input
        type="image"
        src="images/add_24dp.svg"
        alt="add button"
        class="info-bar-img info-bar-item"
        id="addButton"
      />
      <input
        type="image"
        src="images/arrow_back_24dp.svg"
        alt="undo"
        class="info-bar-img-l info-bar-img info-bar-item-l info-bar-item"
        id="undoButton"
      />
      <input
        type="image"
        src="images/refresh_24dp.svg"
        alt="reload"
        class="info-bar-img-m info-bar-img info-bar-item-m info-bar-item"
        id="reloadButton"
      />
      <input
        type="image"
        src="images/arrow_forward_24dp.svg"
        alt="redo"
        class="info-bar-img-r info-bar-img info-bar-item-r info-bar-item"
        id="redoButton"
      />
      <input
        type="text"
        placeholder="enter url or search with google"
        class="url-input info-bar-item"
        id="urlInput"
        onkeydown="onKeyDown(event)"
      />
    </div>
    <webview src="pages/start.html" class="website-iframe" id="websiteIFrame">
    </webview>
    <div class="loader-div" id="loaderDiv">
      <div class="loader1"></div>
      <div class="loader2"></div>
    </div>
  </body>
  <script>
    const logoButton = document.getElementById("logoButton");
    const reloadButton = document.getElementById("reloadButton");
    const websiteIFrame = document.getElementById("websiteIFrame");
    const urlInput = document.getElementById("urlInput");
    const addButton = document.getElementById("addButton");
    const appTitle = document.getElementById("appTitle");
    const loaderDiv = document.getElementById("loaderDiv");
    const undoButton = document.getElementById("undoButton");
    const redoButton = document.getElementById("redoButton");

    function onKeyDown(event) {
      const key = event.key;

      if (key == "Enter") {
        const searchValue = urlInput.value;
        let searchIsUrl = false;

        if (searchValue.includes("https://") || searchValue.includes("http://"))
          searchIsUrl = true;

        for (let i = 0; i < topLevelDomains.length; i++) {
          const element = topLevelDomains[i];
          if (searchValue.includes(element)) {
            searchIsUrl = true;
            break;
          }
        }

        if (searchIsUrl) {
          if (
            searchValue.includes("https://") ||
            searchValue.includes("http://")
          )
            websiteIFrame.src = searchValue;
          else websiteIFrame.src = "https://" + searchValue;
        } else {
          const newSearchValue = searchValue.replace(" ", "+");
          websiteIFrame.src =
            "https://www.google.com/search?q=" + newSearchValue;
        }
      }
    }

    redoButton.onclick = () => {
      websiteIFrame.goForward();
    };

    undoButton.onclick = () => {
      websiteIFrame.goBack();
    };

    addButton.onclick = () => {
      window.windowAPI.newWindow();
    };

    websiteIFrame.addEventListener("did-stop-loading", () => {
      websiteIFrame.classList.remove("blur");
      appTitle.innerHTML = "Star browser - " + websiteIFrame.getTitle();
      urlInput.value = websiteIFrame.src;
      loaderDiv.hidden = true;
    });

    websiteIFrame.addEventListener("did-start-loading", () => {
      websiteIFrame.classList.add("blur");
      appTitle.innerHTML = "Star browser - Loading...";
      loaderDiv.hidden = false;
    });

    const topLevelDomains = [
      ".com",
      ".io",
      ".nl",
      ".de",
      ".org",
      ".net",
      ".int",
      ".edu",
      ".eu",
      ".amazon",
      ".app",
      ".dev",
      ".it",
      ".xyz",
      ".gov",
      ".mil",
      ".arpa",
      ".academy",
      ".accountant",
      ".accountants",
      ".active",
      ".actor",
      ".ads",
      ".aero",
    ];

    reloadButton.onclick = () => {
      websiteIFrame.reload();
    };

    logoButton.onclick = () => {
      websiteIFrame.src = "https://www.google.com/";
      urlInput.value = websiteIFrame.src;
    };

    window.windowAPI.setWindowURL((url) => {
      console.log(`data delivered to renderer.js:  and ${url}`);
      websiteIFrame.src = url;
    });
  </script>
</html>
